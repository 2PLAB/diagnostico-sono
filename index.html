<!DOCTYPE html>
<html class="light" lang="pt-br">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Diagnóstico de Sono Profundo</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet"/>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .screen { display: none; opacity: 0; transition: opacity 0.4s ease-in-out; }
        .screen.active { display: block; opacity: 1; }
        /* Animação de Barra de Progresso Falsa */
        @keyframes loadFake { 0% { width: 0%; } 50% { width: 70%; } 100% { width: 100%; } }
        .fake-load-bar { animation: loadFake 3s ease-in-out forwards; }
    </style>
</head>
<body class="bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-slate-100">

<div id="app">
    <div id="screen-inicio" class="screen active">
        <div class="min-h-screen flex flex-col items-center justify-center px-4 py-12 text-center">
            <div class="bg-blue-100 dark:bg-blue-900/30 p-4 rounded-full mb-6">
                <span class="material-symbols-outlined text-5xl text-blue-600">neurology</span>
            </div>
            <h1 class="text-4xl md:text-5xl font-black tracking-tighter mb-6 max-w-4xl text-slate-900 dark:text-white">
                Seu cérebro não desliga à noite?
            </h1>
            <p class="text-lg text-slate-600 dark:text-slate-400 mb-8 max-w-2xl mx-auto leading-relaxed">
                Faça o diagnóstico clínico de 1 minuto e descubra qual dos <strong>3 Tipos de Insônia</strong> está afetando seu Sistema Nervoso.
            </p>
            <button onclick="navigateTo('quiz-1')" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-10 rounded-xl shadow-lg hover:shadow-blue-500/30 hover:scale-105 transition-all text-lg">
                Começar Análise Gratuita
            </button>
            <p class="mt-4 text-xs text-slate-400 uppercase tracking-widest font-semibold">Baseado em Neurociência</p>
        </div>
    </div>

    <div id="quiz-container" class="screen">
        <div class="min-h-screen flex flex-col items-center justify-center p-4">
            <div class="w-full max-w-xl bg-white dark:bg-slate-900 p-8 rounded-2xl shadow-xl border border-slate-200 dark:border-slate-800">
                <div id="quiz-progress" class="mb-8">
                    <div class="flex justify-between mb-2 text-xs font-bold uppercase text-slate-400">
                        <span id="q-number">Pergunta 1 de 5</span>
                        <span id="q-percent">20%</span>
                    </div>
                    <div class="h-2 w-full bg-slate-100 dark:bg-slate-800 rounded-full overflow-hidden">
                        <div id="q-bar" class="h-full bg-blue-600 rounded-full transition-all duration-500" style="width: 20%"></div>
                    </div>
                </div>
                <h2 id="q-title" class="text-2xl font-bold mb-8 text-slate-900 dark:text-white leading-tight">Título da Pergunta</h2>
                <div id="q-options" class="space-y-4">
                    </div>
                <button onclick="nextQuestion()" class="mt-8 w-full bg-slate-900 dark:bg-blue-600 text-white font-bold py-4 rounded-xl flex items-center justify-center gap-2 hover:bg-slate-800 transition-colors">
                    Confirmar Resposta <span class="material-symbols-outlined">check</span>
                </button>
            </div>
        </div>
    </div>

    <div id="screen-calculando" class="screen">
        <div class="min-h-screen flex flex-col items-center justify-center p-4 text-center">
            <h2 class="text-2xl font-bold mb-4 text-slate-900 dark:text-white">Analisando seus padrões de sono...</h2>
            <div class="w-full max-w-xs h-4 bg-slate-200 dark:bg-slate-800 rounded-full overflow-hidden mb-4">
                <div class="h-full bg-blue-600 fake-load-bar"></div>
            </div>
            <div id="analise-texto" class="text-slate-500 text-sm animate-pulse">Cruzando dados com neurofisiologia...</div>
        </div>
    </div>

    <div id="screen-captura" class="screen">
        <div class="min-h-screen flex flex-col items-center justify-center p-4 text-center">
            <div class="w-full max-w-md bg-white dark:bg-slate-900 p-8 rounded-2xl shadow-2xl border border-blue-100 dark:border-slate-800">
                <div class="mb-6">
                    <span class="bg-green-100 text-green-700 text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wide">Diagnóstico Concluído</span>
                </div>
                <h2 class="text-2xl font-bold mb-2 text-slate-900 dark:text-white">Perfil Encontrado.</h2>
                <p class="text-slate-600 dark:text-slate-400 mb-6 text-sm">
                    Identificamos o padrão exato que impede seu descanso. Digite seu e-mail para receber o relatório completo e a técnica recomendada.
                </p>
                <input id="email-input" type="email" placeholder="Seu melhor e-mail aqui" class="w-full p-4 rounded-xl border border-slate-300 dark:bg-slate-800 dark:border-slate-700 mb-4 focus:ring-2 focus:ring-blue-500 outline-none transition-all">
                <button onclick="finalizarLead()" id="btn-finalizar" class="w-full bg-blue-600 text-white font-bold py-4 rounded-xl hover:bg-blue-700 shadow-lg transition-all flex justify-center items-center gap-2">
                    Ver Meu Resultado Agora
                </button>
                <p class="mt-4 text-xs text-slate-400 flex items-center justify-center gap-1">
                    <span class="material-symbols-outlined text-sm">lock</span> Seus dados estão seguros.
                </p>
            </div>
        </div>
    </div>

    <div id="screen-resultado" class="screen">
        <div class="min-h-screen flex flex-col items-center justify-center p-4">
             <div class="loading-spinner border-4 border-blue-200 border-t-blue-600 rounded-full w-12 h-12 animate-spin"></div>
        </div>
    </div>
</div>

<script>
    // --- LÓGICA DO QUIZ ---
    const questions = [
        { title: "Como você avalia a qualidade do seu sono na última semana?", options: [{l: "Excelente (Acordo renovado)", v: 1}, {l: "Regular (Acordo ok)", v: 2}, {l: "Ruim (Acordo exausto)", v: 4}], name: "q1" },
        { title: "Quanto tempo você leva para pegar no sono?", options: [{l: "Menos de 15 min", v: 1}, {l: "Entre 15 e 45 min", v: 2}, {l: "Mais de 1 hora", v: 3}], name: "q2" },
        { title: "Você acorda durante a madrugada?", options: [{l: "Nunca", v: 0}, {l: "Às vezes (para ir ao banheiro)", v: 2}, {l: "Sempre (e demoro a voltar)", v: 4}], name: "q3" },
        { title: "Qual sensação define sua mente ao deitar?", options: [{l: "Tranquila", v: 1}, {l: "Pensamentos aleatórios", v: 2}, {l: "Preocupação/Ansiedade", v: 4}], name: "q4" },
        { title: "Você usa telas (celular/TV) na cama?", options: [{l: "Não", v: 0}, {l: "Um pouco", v: 2}, {l: "Sim, até dormir", v: 3}], name: "q5" }
    ];

    // Ajustei levemente os pesos das perguntas para garantir perfis mais distintos

    let currentQ = 0;
    let score = 0;

    function navigateTo(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        if(id === 'quiz-1') {
            renderQuestion();
            document.getElementById('quiz-container').classList.add('active');
        } else {
            document.getElementById(`screen-${id}`).classList.add('active');
        }
        window.scrollTo(0,0);
    }

    function renderQuestion() {
        const q = questions[currentQ];
        document.getElementById('q-number').innerText = `Pergunta ${currentQ + 1} de ${questions.length}`;
        const pct = ((currentQ+1)/questions.length)*100;
        document.getElementById('q-percent').innerText = `${Math.round(pct)}%`;
        document.getElementById('q-bar').style.width = `${pct}%`;
        
        // Animação suave de entrada
        const titleEl = document.getElementById('q-title');
        titleEl.style.opacity = 0;
        setTimeout(() => { 
            titleEl.innerText = q.title; 
            titleEl.style.opacity = 1; 
        }, 200);
        
        const container = document.getElementById('q-options');
        container.innerHTML = '';
        
        q.options.forEach(opt => {
            const div = document.createElement('div');
            div.innerHTML = `
                <label class="flex items-center gap-4 p-5 border-2 rounded-xl cursor-pointer hover:bg-blue-50 hover:border-blue-200 transition-all border-slate-100 dark:border-slate-800 dark:hover:bg-slate-800 bg-white dark:bg-slate-900 group">
                    <div class="w-6 h-6 rounded-full border-2 border-slate-300 group-hover:border-blue-500 flex items-center justify-center">
                        <div class="w-3 h-3 rounded-full bg-blue-500 opacity-0 transition-opacity check-circle"></div>
                    </div>
                    <input type="radio" name="quiz_opt" value="${opt.v}" class="hidden" onchange="selectOption(this)">
                    <span class="font-semibold text-lg text-slate-700 dark:text-slate-300 group-hover:text-blue-700 dark:group-hover:text-white">${opt.l}</span>
                </label>
            `;
            container.appendChild(div);
        });
    }

    function selectOption(input) {
        // Remove seleção visual anterior
        document.querySelectorAll('.check-circle').forEach(el => el.classList.remove('opacity-100'));
        document.querySelectorAll('label').forEach(el => el.classList.remove('border-blue-500', 'bg-blue-50'));
        
        // Adiciona visual novo
        const label = input.closest('label');
        label.classList.add('border-blue-500', 'bg-blue-50');
        label.querySelector('.check-circle').classList.add('opacity-100');
    }

    function nextQuestion() {
        const selected = document.querySelector('input[name="quiz_opt"]:checked');
        if(!selected) return alert("Por favor, selecione uma opção para continuar.");
        
        score += parseInt(selected.value);
        currentQ++;

        if(currentQ < questions.length) {
            renderQuestion();
        } else {
            // LÓGICA NOVA: Mostrar tela de "Calculando" antes da captura
            navigateTo('calculando');
            iniciarPseudoCalculo();
        }
    }

    function iniciarPseudoCalculo() {
        const textos = [
            "Analisando níveis de estresse...",
            "Verificando ciclo circadiano...",
            "Calculando índice de recuperação...",
            "Perfil encontrado!"
        ];
        const textoEl = document.getElementById('analise-texto');
        let i = 0;
        
        const interval = setInterval(() => {
            if(i < textos.length) {
                textoEl.innerText = textos[i];
                i++;
            } else {
                clearInterval(interval);
                navigateTo('captura');
            }
        }, 800); // 3.2 segundos total de espera (Gatilho mental de valor)
    }

    async function finalizarLead() {
        const email = document.getElementById('email-input').value;
        const btn = document.getElementById('btn-finalizar');
        
        if(!email.includes('@') || !email.includes('.')) return alert("Por favor, insira um e-mail válido.");

        // UI Loading no Botão
        btn.innerHTML = `<span class="material-symbols-outlined animate-spin">refresh</span> Processando...`;
        btn.disabled = true;

        // Webhook URL (MANTENHA A SUA URL AQUI)
        const URL_PLANILHA = "https://script.google.com/macros/s/AKfycbx7BXCTvZQOmpMG_85HQ5ZmzV5wKxNwM9jx2Fc6lIK1zupPClFPZBwKcpydFZ_qyhst/exec";

        // Definição do Perfil (Replica Lógica do Backend)
        let perfilSlug;
        if(score >= 12) perfilSlug = "alto";
        else if(score >= 8) perfilSlug = "moderado";
        else perfilSlug = "baixo";

        try {
            // Envia para o Google Sheets (No-Cors)
            await fetch(URL_PLANILHA, {
                method: 'POST',
                mode: 'no-cors', 
                body: JSON.stringify({ email: email, score: score })
            });
            
            // Redirecionamento Final
            setTimeout(() => {
                window.location.href = `vendas.html?perfil=${perfilSlug}`;
            }, 500);

        } catch (error) {
            console.error("Erro no envio:", error);
            // Fallback: Redireciona mesmo se der erro no tracking, para não perder a venda
            window.location.href = `vendas.html?perfil=${perfilSlug}`;
        }
    }
</script>
</body>
</html>
